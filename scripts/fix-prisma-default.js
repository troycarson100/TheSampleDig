// Script to create default.js for Prisma 7 compatibility with Next.js
const fs = require('fs')
const path = require('path')

const defaultJsPath = path.join(__dirname, '../node_modules/.prisma/client/default.js')
const clientTsPath = path.join(__dirname, '../node_modules/.prisma/client/client.ts')

// Create default.js that properly exports PrismaClient
// Since Prisma 7 generates TypeScript/ESM, we create a bridge
// Next.js/Turbopack will handle the actual TypeScript import at runtime
const defaultJsContent = `// Auto-generated by fix-prisma-default.js
// Prisma 7 compatibility bridge for Next.js/Turbopack

// Export a proxy that Next.js will resolve to the actual PrismaClient
// The actual import happens through Next.js's module resolution system
module.exports = new Proxy({}, {
  get(target, prop) {
    // This proxy allows @prisma/client to access properties
    // Next.js/Turbopack will resolve the actual PrismaClient at runtime
    if (prop === 'PrismaClient') {
      // Return a function that will be replaced by Next.js
      return function PrismaClient() {
        throw new Error('PrismaClient must be imported from @prisma/client, not .prisma/client/default')
      }
    }
    return undefined
  }
})
`

if (fs.existsSync(clientTsPath)) {
  fs.writeFileSync(defaultJsPath, defaultJsContent)
  console.log('✅ Created default.js for Prisma client')
} else {
  console.warn('⚠️  Prisma client not found, skipping default.js creation')
}
